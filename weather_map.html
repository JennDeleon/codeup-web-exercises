<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <title>Cody's Weather</title>
    <!-- Mapbox CSS -->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'/>
    <link href="https://fonts.googleapis.com/css2?family=Syne+Tactile&display=swap" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css' rel='stylesheet'/>
    <link rel="stylesheet"
          href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css"
          type="text/css">
    <!-- Custom CSS -->

    <style>
        table {
            margin-left: auto;
            margin-right: auto;
            max-width: 90%;
            background-color: #f1f2f1;

        }

        .one, th {
            color: #ffbf00;
            text-shadow: 1px 1px lightgray;
        }

        th {
            color: #7cb342;
        }

        h1, h2 {
            font-family: 'VT323', monospace;
            color: #7cb342;
            text-align: center;
        }

        img {
            width: 100px;
            height: 80px;
        }


        #map {
            width: 100%;
            height: 700px;
            border: solid #ffbf00;
            margin-left: 20%;
            margin-top: 3em;
        }
        #rain {
            height: 5em;
        }


    </style>
</head>

<!--       BODY      -->
<body>

<h1><img src=images/cody.png alt="rubber-duck">Cody's weather report!</h1>

<table class="table table-sm ">

    <thead>
    <tr>
        <th scope="col"></th>
        <th scope="col">Sunday</th>
        <th scope="col">Monday</th>
        <th scope="col">Tuesday</th>
        <th scope="col">Wednesday</th>
        <th scope="col">Thursday</th>
        <th scope="col">Friday</th>
        <th scope="col">Saturday</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td id="high" class="one">High</td>
        <td id="sunday"></td>
        <td id="monday"></td>
        <td id="tuesday"></td>
        <td id="wednesday"></td>
        <td id="thursday"></td>
        <td id="friday"></td>
        <td id="saturday"></td>
    </tr>
    <tr>
        <td id="low" class="one">Low</td>
        <td id="sundayTwo"></td>
        <td id="mondayTwo"></td>
        <td id="tuesdayTwo"></td>
        <td id="wednesdayTwo"></td>
        <td id="thursdayTwo"></td>
        <td id="fridayTwo"></td>
        <td id="saturdayTwo"></td>
    </tr>
    <tr>
        <td id="rain" class="one">Weather</td>
        <td id="sundayThree"></td>
        <td id="mondayThree"></td>
        <td id="tuesdayThree"></td>
        <td id="wednesdayThree"></td>
        <td id="thursdayThree"></td>
        <td id="fridayThree"></td>
        <td id="saturdayThree"></td>
    </tr>
    </tbody>
</table>


<div id='map' style='width: 600px; height: 450px;'></div>

<script src="js/jquery-2.2.4.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
<script src="keys.js"></script>
<script>
    function color(element, description) {
        if (description === 'clear sky') {
            element.css('color', 'green');
        } else if (description === 'light rain') {
            element.css('color', 'blue');
        } else if (description === 'cloudy' || description === 'few clouds' || description === 'clouds' || description === 'cloudsovercast') {
            element.css('color', '#5a7f9c');
        } else if (description === 'snow' || description === 'light snow') {
            element.css('color', 'red');
        }
    }

    function getWeather(lng, lat) {
        $.get("http://api.openweathermap.org/data/2.5/onecall", {
            APPID: OPENWEATHER_KEY,
            lat: lat,
            lon: lng,
            units: "imperial"
        }).done(function (data) {
            console.log('The entire response:', data);

            // max
            $('#sunday').append(Math.round(data.daily[0].temp.max));
            $('#monday').append(Math.round(data.daily[1].temp.max));
            $('#tuesday').append(Math.round(data.daily[2].temp.max));
            $('#wednesday').append(Math.round(data.daily[3].temp.max));
            $('#thursday').append(Math.round(data.daily[4].temp.max));
            $('#friday').append(Math.round(data.daily[5].temp.max));
            $('#saturday').append(Math.round(data.daily[6].temp.max));

            // min
            $('#sundayTwo').append(Math.round(data.daily[0].temp.min));
            $('#mondayTwo').append(Math.round(data.daily[1].temp.min));
            $('#tuesdayTwo').append(Math.round(data.daily[2].temp.min));
            $('#wednesdayTwo').append(Math.round(data.daily[3].temp.min));
            $('#thursdayTwo').append(Math.round(data.daily[4].temp.min));
            $('#fridayTwo').append(Math.round(data.daily[5].temp.min));
            $('#saturdayTwo').append(Math.round(data.daily[6].temp.min));

            //weather
            $('#sundayThree').append(data.daily[0].weather[0].description);
            color($('#sundayThree'), data.daily[0].weather[0].description);
            $('#mondayThree').append(data.daily[1].weather[0].description);
            color($('#mondayThree'), data.daily[1].weather[0].description);
            $('#tuesdayThree').append(data.daily[2].weather[0].description);
            color($('#tuesdayThree'), data.daily[2].weather[0].description);
            $('#wednesdayThree').append(data.daily[3].weather[0].description);
            color($('#wednesdayThree'), data.daily[3].weather[0].description);
            $('#thursdayThree').append(data.daily[4].weather[0].description);
            color($('#thursdayThree'), data.daily[4].weather[0].description);
            $('#fridayThree').append(data.daily[5].weather[0].description);
            color($('#fridayThree'), data.daily[5].weather[0].description);
            $('#saturdayThree').append(data.daily[6].weather[0].description);
            color($('#saturdayThree'), data.daily[6].weather[0].description);


            console.log('The entire response:', data);
        });
    }
    (function () {
        "use strict";

        getWeather(-98.7068, 29.5696);

        mapboxgl.accessToken = firstToken;
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v10',
            center: [-98.7068, 29.5696], // starting position [lng, lat]
            zoom: 10 // starting zoom
        });

        var geocoder = new MapboxGeocoder({
            accessToken: firstToken,
            mapboxgl: mapboxgl,
            zoom: 12
        })

        geocoder.on('result', (event) => {
            var lng = event.result.center[0]
            var lat = event.result.center[1]
            getWeather(lng, lat)
        });

        map.addControl(
            geocoder
        );




        map.on('mouseenter', 'circle', () => {
            map.getCanvas().style.cursor = 'pointer';
        });


        function geocode(search, token = OPENWEATHER_KEY) {
            var baseUrl = 'https://api.mapbox.com';
            var endPoint = '/geocoding/v5/mapbox.places/';
            return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
                .then(function (res) {
                    return res.json();
                }).then(function (data) {
                    let [lon, lat] = data.features[0].center;
                    getWeatherData(lon, lat)
                });
        }


    })();
</script>
</body>
</html>